---
description: A module used to append a tax payment to any agreed transfer.
---

# Tax

This module defines a tax payment that will be attached to any **agreed** ADO transfers undertaken within the contract. **This payment is not required when the owner of the ADO is executing a transfer and is only required on an agreed transfer.** **Any rounding caused by the module favours the tax receiver.**

Any payments generated by the module will be recorded in the response event and are **added to the agreed transfer amount**. A separate payment will be generated for each receiver and will be the same amount for each receiver and not divided amongst them.

## Definition

{% tabs %}
{% tab title="Rust" %}
```rust
#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]
pub struct Taxable {
    pub rate: Rate,
    pub receivers: Vec<String>,
}

```
{% endtab %}

{% tab title="Javascript" %}
```javascript
{
    "taxable": {
        "rate": {
            "flat": {
                "amount": 2,
                "denom": "uluna"
            }
        },
        "receivers": ["terra1...", "terra1..."],
        "description": "Some tax payment to be made to..."
    }
}
```
{% endtab %}
{% endtabs %}

| Name      | Type         | Description                                                                                                                                 |
| --------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------- |
| rate      | Rate         | The amount to be paid to each receiver upon an agreed transfer. See more [here](https://docs.andromedaprotocol.io/andromeda/modules#rates). |
| receivers | Vec\<String> | An address list of recipients for the royalty fee                                                                                           |

## Methods

### `calculate_fee`

Used to calculate the required payment for a given amount. **Returns a `Coin` fee amount.**

```rust
pub fn calculate_fee(&self, payment: Coin) -> Coin {
    let fee_amount = payment
        .amount
        .multiply_ratio(Uint128::from(self.fee), 100 as u128);

    coin(fee_amount.u128(), payment.denom)
}
```

| Name    | Type | Description                             |
| ------- | ---- | --------------------------------------- |
| payment | Coin | The amount to calculate the fee against |

## Hooks

The Tax module implements the following hooks:

### `on_agreed_transfer`

Used to append the required tax payments to the agreed transfer payments.

```rust
fn on_agreed_transfer(
    &self,
    _deps: &DepsMut,
    _info: MessageInfo,
    env: Env,
    payments: &mut Vec<cosmwasm_std::BankMsg>,
    _owner: String,
    _purchaser: String,
    agreed_payment: Coin,
) -> StdResult<HookResponse> {
    let _contract_addr = env.contract.address;
    let tax_amount = calculate_fee(self.rate.clone(), agreed_payment);

    let mut resp = HookResponse::default();
    let mut event = Event::new(TAX_EVENT_ID);

    match self.description.clone() {
        Some(desc) => {
            event = event.add_attribute(ATTR_DESC, desc);
        }
        None => {}
    }
    // No deduction of payment because the buyer pays the tax while royalties are paid by seller [ROY-01]
    for receiver in self.receivers.to_vec() {
        add_payment(payments, receiver.clone(), tax_amount.clone());
        event = event.add_attribute(
            ATTR_PAYMENT,
            PaymentAttribute {
                receiver: receiver.clone(),
                amount: tax_amount.clone(),
            }
            .to_string(),
        );
    }
    resp = resp.add_event(event);

    Ok(resp)
}
```

## Validation

The Tax module does not have any validation requirements.

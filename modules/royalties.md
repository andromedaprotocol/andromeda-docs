---
description: A module used to append a royalty payment to any agreed transfer.
---

# Royalties

This module defines a royalty payment that will be attached to any **agreed** ADO transfers undertaken within the contract. **This payment is not required when the owner of the ADO is executing a transfer and is only required on an agreed transfer.** **Any rounding caused by the module favours the royalty receiver.**

Any payments generated by the module will be recorded in the response event and are **deducted from the ADO seller**. A separate payment will be generated for each receiver and will be the same amount for each receiver and not divided amongst them.

## Definition

{% tabs %}
{% tab title="Rust" %}
```rust
#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]
pub struct Royalty {
    pub rate: Rate,
    pub receivers: Vec<String>,
    pub description: Option<String>,
}
```
{% endtab %}

{% tab title="Javascript" %}
```javascript
{
    "royalty": {
        "rate": {
            "percent": "2"
        },
        "receivers": ["terra1...", "terra1..."],
        "description": "Some royalty payment to be made to..."
    }
}
```
{% endtab %}
{% endtabs %}

| Name        | Type            | Description                                                                                                                                 |
| ----------- | --------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| rate        | Rate            | The amount to be paid to each receiver upon an agreed transfer. See more [here](https://docs.andromedaprotocol.io/andromeda/modules#rates). |
| receivers   | Vec\<String>    | An address list of recipients for the royalty fee                                                                                           |
| description | Option\<String> | An optional description of the royalty payment                                                                                              |

## Methods

### `calculate_fee`

Used to calculate the required payment for a given amount. **Returns a `Coin` fee amount.**

```rust
pub fn calculate_fee(&self, payment: Coin) -> Coin {
    let fee_amount = payment
        .amount
        .multiply_ratio(Uint128::from(self.fee), 100 as u128);

    coin(fee_amount.u128(), payment.denom)
}
```

| Name    | Type | Description                             |
| ------- | ---- | --------------------------------------- |
| payment | Coin | The amount to calculate the fee against |

## Hooks

The Royalties module implements the following hooks:

### `on_agreed_transfer`

Used to append the required royalty payments to the agreed transfer payments and deduct the funds from the payment being made to the seller.

```rust
fn on_agreed_transfer(
    &self,
    _deps: &DepsMut,
    _info: MessageInfo,
    _env: Env,
    payments: &mut Vec<cosmwasm_std::BankMsg>,
    owner: String,
    _purchaser: String,
    amount: cosmwasm_std::Coin,
) -> StdResult<HookResponse> {
    let fee_payment = calculate_fee(self.rate.clone(), amount);
    let mut resp = HookResponse::default();
    let mut event = Event::new("royalty");

    match self.description.clone() {
        Some(desc) => {
            event = event.add_attribute(ATTR_DESC, desc);
        }
        None => {}
    }

    for receiver in self.receivers.to_vec() {
        // Deducts the required payment since it should be paid by token owner. [ROY-01]
        deduct_payment(payments, owner.clone(), fee_payment.clone())?;
        event = event.add_attribute(ATTR_DEDUCTED, fee_payment.to_string());
        add_payment(payments, receiver.clone(), fee_payment.clone());
        event = event.add_attribute(
            ATTR_PAYMENT,
            PaymentAttribute {
                receiver: receiver.clone(),
                amount: fee_payment.clone(),
            }
            .to_string(),
        );
    }

    resp = resp.add_event(event);

    Ok(resp)
}
```

## Validation

The Royalties module does not have any validation requirements.
